<!doctype html>
<html>
<head>
    <title>ostinato-xhr demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">

    <link rel="import" href="../ostinato-xhr.html">

    <style is="custom-style" include="demo-pages-shared-styles">
    </style>

    <script>
        function loadContent() {
            var xhr = document.querySelector('#xhr');
            xhr.generateRequest('view1.html');
        }

        // OUr custom xhr-context
        Polymer({
            is: 'xhr-context',
            behaviors: [XHRContextBehavior]
        });
    </script>
</head>

<body>

    <div class="vertical-section-container centered">
        <h3>Basic ostinato-xhr usage</h3>

        <h4>ostinato-xhr-triggers</h4>
        <p>Use <code>ostinato-xhr-triggers</code> to specify triggers for your
        <code>ostinato-xhr</code> element.</p>

        <h4>Update History</h4>
        <p>Notice how the browser history (and title) is upddated because
        <code>update-hisory</code> property is set to True.</p>

        <demo-snippet>
            <template>
                <button onclick="loadContent()">Load Content manually (view1.html)</button>

                <hr>

                <a href="view1.html" xhr-link>Load view 1</a>
                <a href="view2.html" xhr-link>Load view 2</a>
                <a href="view3.html" xhr-link>Load view 3</a>

                <hr>

                <ostinato-xhr id="xhr"
                              target-selectors="#content"
                              update-history
                              xhr-context-selector="xhr-context">
                </ostinato-xhr>

                <div id="content">
                    <!-- content gets inserted here -->
                </div>

                <ostinato-xhr-triggers id="basicTriggers" xhr-selector="#xhr"></ostinato-xhr-triggers>

                <script>
                    (function() {
                        var xhr = document.querySelector('#xhr');

                        // We are going to manually call the link events, since the
                        // demo-snippet breaks the behaviour.
                        // That said it does serve as a example of how it can be
                        // triggered manually.
                        var triggers = document.querySelector('#basicTriggers');
                        var triggerLinks = document.querySelectorAll('[xhr-link]');
                        triggerLinks.forEach(function(link) {
                            link.addEventListener('click', function(ev) {
                                ev.preventDefault();
                                console.log(triggers);
                                triggers.triggerRequest(ev.target.href);
                            });
                        });

                        // Example of how events can be used to show loading
                        // notifications etc.
                        xhr.addEventListener('request-started', function(ev) {
                            document.querySelector('#content').innerHTML = 'LOADING...';
                            console.log('Started...');
                        });

                        xhr.addEventListener('request-completed', function(ev) {
                            console.log('Completed...');
                        });

                        xhr.addEventListener('content-updated', function(ev) {
                            console.log('Updated...');
                        });
                    })();
                </script>
            </template>
        </demo-snippet>
    </div>

    <div class="vertical-section-container centered">
        <h3>Update multiple containers</h3>
        <p>In this example, the document being loaded, <code>multiview.html</code>,
        has a lot of content. But <code>ostinato-xhr</code> will only pull out the content
        that we specify. In this case it's just a header and content</p>

        <demo-snippet>
            <template>
                <a href="multiview.html" xhr-multi>Load content</a>

                <ostinato-xhr id="xhrMultiple"
                              target-selectors="#multiHeader,#multiContent">
                </ostinato-xhr>

                <div id="multiple">
                    <div id="multiHeader">
                        <p>This is a header container</p>
                    </div>

                    <p style="font-weight: bold; color: red;">Some content that should not be updated.</p>

                    <div id="multiContent">
                        <p>This is a content container</p>
                    </div>
                </div>

                <ostinato-xhr-triggers
                    id="multiTriggers"
                    xhr-selector="#xhrMultiple"
                    trigger-selector="[xhr-multi]"></ostinato-xhr-triggers>

                <script>
                    (function() {
                        // We are going to manually call the link events, since the
                        // demo-snippet breaks the behaviour.
                        // That said it does serve as a example of how it can be
                        // triggered manually.
                        var triggers = document.querySelector('#multiTriggers');
                        var triggerLinks = document.querySelectorAll('[xhr-multi]');
                        triggerLinks.forEach(function(link) {
                            link.addEventListener('click', function(ev) {
                                ev.preventDefault();
                                triggers.triggerRequest(ev.target.href);
                            });
                        });
                    })();
                </script>
            </template>
        </demo-snippet>
    </div>

    <div class="vertical-section-container centered">
        <h3>ostinato-xhr-form</h3>
        <demo-snippet>
            <template>
                <div id="formContent">
                    <ostinato-xhr-form target-selectors="#formContent">
                        <form action="https://httpbin.org/post" method="post">
                            <input type="text" name="name">
                            <input type="submit" value="submit name" confirm>
                        </form>
                    </ostinato-xhr-form>
                </div>
            </template>
        </demo-snippet>
    </div>

</body>
</html>
